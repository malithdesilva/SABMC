@model SabraMedicalCenter.Areas.Admin.Models.MedicalFormDTO

@{
    ViewBag.Title = "";
    Layout = "~/Areas/Admin/Views/Shared/SideLayout.cshtml";
}

<br />
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/dist/css/AdminLTE.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery-ui.min.js"></script>
<link href="~/Scripts/jquery-ui.min.css" rel="stylesheet" />
<link href="~/Content/medicalform.css" rel="stylesheet" />
@*<link href="~/Scripts/jtable/themes/metro/green/jtable.min.css" rel="stylesheet" />*@
@*<link href="~/Scripts/jtable/themes/metro/blue/jtable.min.css" rel="stylesheet" />*@
@*<link href="~/Scripts/jtable/themes/lightcolor/blue/jtable.min.css" rel="stylesheet" />*@
@*<script src="~/Scripts/jtable/jquery.jtable.min.js"></script>*@

@using (Html.BeginForm())
{

    @Html.AntiForgeryToken()
    @*@Html.ValidationSummary(true, "", new { @class = "text-danger" })*@
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

   

    <div class="nav-tabs-custom box box-primary">
        <!-- Tabs within a box -->
        <ul class="nav nav-tabs pull-right">
            @*<li class="active"><a href="#revenue-chart" data-toggle="tab">Area</a></li>*@

            <li class="pull-left header"><i class="fa fa-inbox"></i>Create Medical Form</li>
        </ul>
        <div class="tab-content no-padding">
          
            <div class="container" style="border-style:hidden">
                <div class="form-inline row">

                    <hr />
                    <div class="alert-danger alert-dismissable text-danger">
                        @* <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>*@
                        @ViewBag.medtbl
                    </div>
                    @*  <h3 class="alert-success alert-dismissable">@ViewBag.message</h3>*@
                    <br />

                    @*<input type="text" id="Searchword" class="col-lg-5 form-control search" placeholder="Search by Student Name,Reg No or NIC No" />*@
                    @Html.EditorFor(model => model.Searchword, new { htmlAttributes = new { @class = "col-lg-5 form-control search", placeholder = "Search by Student Name,Reg No or NIC No" } })
                    <input type="button" id="studentsearch" value="Search" class="btn btn-primary col-lg-1 ida" />

                </div>
                <label id="fail" class="alert alert-warning"></label>


                <div class="row well-lg">
                    <div class="form-group col-lg-6">
                        @Html.LabelFor(model => model.Student_RegNo, htmlAttributes: new { @class = "control-label " })
                        @Html.Label(" ", new { @class = "akuru", @id = "Student_RegNo" })
                        @Html.ValidationMessageFor(model => model.Student_RegNo, "", new { @class = "text-danger" })
                        @*<label class="control-label col-lg-4"><font size="4" color="#595959">Reg NO:</font></label>
                    <label class="control-label akuru" id="Student_RegNo"><font size="5" color="black"></font></label>*@
                    </div>

                    <div class="form-group col-lg-6">
                        @Html.LabelFor(model => model.Student_Age, htmlAttributes: new { @class = "control-label " })
                        @Html.Label(" ", new { @class = "akuru", @id = "Student_Age" })
                        @Html.ValidationMessageFor(model => model.Student_Age, "", new { @class = "text-danger" })
                        @*<label class="control-label col-lg-4"><font size="4" color="#595959">Age:</font></label>
                    <label class="control-label akuru" id="Student_Age"></label>*@

                    </div>
                </div>
                <div class="row well-lg">
                    <div class="form-group col-lg-6">
                        @Html.LabelFor(model => model.Student_NicNo, htmlAttributes: new { @class = "control-label " })
                        @Html.Label(" ", new { @class = "akuru", @id = "Student_NicNo" })
                        @Html.ValidationMessageFor(model => model.Student_NicNo, "", new { @class = "text-danger" })
                        @*<label class="control-label col-lg-4"><font size="4" color="#595959">NIC NO:</font></label>
                    <label class="control-label akuru" id="Student_NicNo"></label>*@
                    </div>

                    <div class="form-group col-lg-6">
                        @Html.LabelFor(model => model.Student_Gender, htmlAttributes: new { @class = "control-label " })
                        @Html.Label(" ", new { @class = "akuru", @id = "Student_Gender" })
                        @Html.ValidationMessageFor(model => model.Student_Gender, "", new { @class = "text-danger" })
                        @*<label class="control-label col-lg-4"><font size="4" color="#595959">Gender:</font></label>
                    <label class="control-label akuru" id="Student_Gender"></label>*@
                    </div>
                </div>
                <div class="row well-lg">
                    <div class="form-group col-lg-6">
                        @Html.LabelFor(model => model.Student_Faculty, htmlAttributes: new { @class = "control-label " })
                        @Html.Label(" ", new { @class = "akuru", @id = "Student_Faculty" })
                        @Html.ValidationMessageFor(model => model.Student_Faculty, "", new { @class = "text-danger" })
                        @*<label class="control-label col-lg-4"><font size="4" color="#595959">Faculty:</font></label>
                    <label class="control-label akuru" id="Student_Faculty"></label>*@

                    </div>

                    <div class="form-group col-lg-6">
                        @Html.LabelFor(model => model.Student_Year, htmlAttributes: new { @class = "control-label " })
                        @Html.Label(" ", new { @class = "akuru", @id = "Student_Year" })
                        @Html.ValidationMessageFor(model => model.Student_Year, "", new { @class = "text-danger" })
                        @*<label class="control-label col-lg-4"><font size="4" color="#595959">Academic Year:</font></label>
                    <label class="control-label akuru" id="Student_Year"></label>*@
                    </div>
                </div>
                <br />
                <hr />
                <br />
                <div class="form-horizontal">
                    <div class="form-group">
                        @Html.LabelFor(model => model.MedicalDate, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-5">
                            @Html.EditorFor(model => model.MedicalDate, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.MedicalDate, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.Diesese, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-5">
                            @Html.EditorFor(model => model.Diesese, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.Diesese, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.Description, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-5">
                            @Html.EditorFor(model => model.Description, new { htmlAttributes = new { @class = "form-control search" } })
                            @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <br />
                    <hr />



                    <div class="form-group">

                        @Html.LabelFor(model => model.DrugName, htmlAttributes: new { @class = "control-label col-lg-2" })
                        <div class="col-md-5">
                            @Html.EditorFor(model => model.DrugName, new { htmlAttributes = new { @class = "form-control" } })

                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.DrugQty, htmlAttributes: new { @class = "control-label col-lg-2" })
                        <div class="col-md-5">
                            @Html.EditorFor(model => model.DrugQty, new { htmlAttributes = new { @class = "form-control" } })
                            @*@Html.Label("err", htmlAttributes: new { @class = "control-label col-lg-12", id="error"})*@
                            <label><font id="error" color="red text-danger">err</font></label>
                        </div>
                    </div>
                    <input type="button" id="Addmedicine" value="Add" class="btn btn-primary tn-block btn-sm col-lg-offset-1 col-lg-6" />
                </div>


                @*<div class="row well-lg">
                <input type="button" id="Addmedicine" value="Add" class="btn btn-default col-lg-12 glyphicon-align-center search" />
            </div>*@
                <br /><br /><hr /><br />
                <div class="row well" style="border-style:ridge" id="medicaltable">

                </div>
                @Html.HiddenFor(x => x.studentpk)

                <div class="row col-lg-8">

                    <input type="submit" value="Submit Form" class="btn btn-primary btn-block btn-sm col-lg-offset-1 col-lg-6" />
                    <br />
                    <br />

                </div>
            </div>
        </div>
    </div>
    <button type="button" class="btn btn-info btn-lg" id="hit" data-toggle="modal" data-target="#myModal">Open Modal</button>

        <!-- Modal -->
    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title alert-link">Successful</h4>
                </div>
                <div class="modal-body">
                    <p>@ViewBag.message</p>
                </div>
                <div class="modal-footer">
                    @Html.ActionLink("Close", "AdminPanel", "AdminHandle", new { area = "Admin" }, new { @class = "btn btn btn-success btn-lg col-md-2 col-md-offset-5" })
                    @* <button type="button" class="btn btn-default"  data-dismiss="modal">Close</button>*@
                </div>
            </div>

        </div>
    </div>

}
@if (ViewBag.message != null)
{
    <script>
        debugger;
        $("#hit").trigger("click");
      //  $("#myModal").modal();
    </script>
} 

<script type="text/javascript">
    $(document).ready(function () {
        debugger;

       $("#hit").hide();
        $('#medicaltable').jtable({

            title: 'Precription',

            paging: true, //Enable paging
            pageSize: 10, //Set page size (default: 10)
            sorting: true, //Enable sorting
            defaultSorting: 'Name ASC', //Set default sorting
            actions: {


                listAction: '/AdminHandle/Drugformtable',
                createAction: '/GettingStarted/CreatePerson',
                updateAction: '/GettingStarted/UpdatePerson',
                deleteAction: '/GettingStarted/DeletePerson'
            },


            fields: {
                Drugcode: {
                    key: true,
                    title: 'Drug Code',
                    width: '10%',

                },
                DrugName: {
                    title: 'Drug Name',
                    width: '20%',



                },
                DrugQty: {
                    title: 'Quantity',
                    width: '20%',

                }

            }


        });
        $('#medicaltable').jtable('load');
        $(".jtable-toolbar").hide();
        $('.jtable-edit-command-button').hide();

        $("#Addmedicine").click(function () {
            //var DCode = $("#Drugcode").val();
            var DName = $("#DrugName").val();
            var DQty = $("#DrugQty").val();
            debugger;
            if (DName == "" || DQty == "") {
                $("#error").show();
                $("#error").text("Please fill the drug name and drug code");
                
            }
            else {
                $.ajax({
                    type: "POST",
                    url: "/AdminHandle/AddSessionMedicine",
                    //contentType: "application/json; charset=utf-8",
                    data: { Dname: DName, Dqty: DQty },
                    //dataType: "json",
                    success: function (data) {
                        debugger;
                        if (data.Result == "OK") {
                            $("#DrugName").val(null);
                            $("#DrugQty").val(null);
                            debugger;
                            $('#medicaltable').jtable('load');
                            $(".jtable-toolbar").hide();
                            
                        }
                        else {
                            $("#error").text(data.Result);
                        }

              

                    }


                });
            }
         
        });



        $(function () {
            debugger;
            $("#Searchword").autocomplete({
                source: '@Url.Action("/SearchStudent")'
            });
            $("#fail").hide();
        });

        $(function () {
            debugger;
            $("#DrugName").autocomplete({
                source: '@Url.Action("/GetMedicine")'

            });
            debugger;
            $("#error").hide();
        });

        $("#error").hide();
        $("#studentsearch").click(function () {
            var sTerm = $("#Searchword").val();


            debugger;

            $.ajax({
                type: "POST",
                url: "/AdminHandle/GetStudentDetails",
                //contentType: "application/json; charset=utf-8",
                data: { Searchkey: sTerm },
                dataType: "json",
                success: function (data) {
                    debugger;
                    if (data == "Fail") {
                        $("#fail").show();
                        $("#fail").text("Sry There is no any student with given name");
                    }
                    else {
                        $("#studentpk").val(data.studentpk);
                        $("#Student_RegNo").text(data.Student_RegNo);
                        $("#Student_Age").text(data.Student_Age);
                        $("#Student_Faculty").text(data.Student_Faculty);
                        $("#Student_Year").text(data.Student_Year);
                        $("#Student_Gender").text(data.Student_Gender);
                        $("#Student_NicNo").text(data.Student_NicNo);
                        $("#fail").hide();
                    }


                    // $('#medicaltable').jtable('load');

                }


            });
        });

        $("#DrugQty").keyup(function () {
            var dqty = $("#DrugQty").val();
            var name = $("#DrugName").val();


            debugger;

            $.ajax({
                type: "POST",
                url: "/AdminHandle/checkqty",
                //contentType: "application/json; charset=utf-8",
                data: { qty: dqty, dname: name },
                dataType: "json",
                success: function (data) {
                    debugger;
                    if (data == "OK") {
                        $("#error").hide();
                    }
                    else {
                        $("#error").show();
                        $("#error").text(data);

                    }

                    // $('#medicaltable').jtable('load');

                }


            });
        });
        $("#Searchword").keyup(function () {
            $(".text-danger").hide();
        });
        $("#Diesese").keyup(function () {
            $(".text-danger").hide();
        });
        $("#Description").keyup(function () {
            $(".text-danger").hide();
        });
        $("#MedicalDate").click(function () {
            $(".text-danger").hide();
        });
        $("#DrugName").keyup(function () {
            $(".text-danger").hide();
        });
        $("#DrugQty").keyup(function () {
            $(".text-danger").hide();
        });
    });

</script>